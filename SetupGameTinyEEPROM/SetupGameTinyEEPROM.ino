#include "ssd1306.h"

#define PIN_SDA PB4
#define PIN_SCL PB0

#define LOGO_EEPROM_ADDR 30
#define HIGH_SCORE_EEPROM_ADDR 160

const unsigned char gameTinyLogo [160] = {
0x00, 0xE0, 0x30, 0x28, 0x24, 0x24, 0x24, 0x24, 0x24, 0x24, 0x24, 0x24, 0x24, 0xE4, 0x14, 0x0C,
0xFC, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x3E, 0x41, 0x41,
0x49, 0x3A, 0x00, 0x00, 0x00, 0xFF, 0x00, 0x80, 0xFF, 0x00, 0x00, 0x7E, 0x09, 0x09, 0x09, 0x7E,
0x00, 0x00, 0x7F, 0x01, 0x7E, 0x01, 0x7F, 0x00, 0x00, 0x7F, 0x49, 0x49, 0x49, 0x49, 0x00, 0x00,
0x00, 0xFF, 0x02, 0x02, 0x02, 0x12, 0x12, 0xF2, 0x12, 0x12, 0x02, 0x02, 0x02, 0xFF, 0x01, 0x00,
0xFF, 0x00, 0x00, 0x10, 0x10, 0xF0, 0x10, 0x10, 0x00, 0x00, 0xF0, 0x10, 0xE0, 0x00, 0xF0, 0x00,
0x00, 0x70, 0x80, 0x80, 0x80, 0x70, 0x00, 0x00, 0x00, 0x3F, 0x20, 0x20, 0x20, 0x20, 0x20, 0x27,
0x20, 0x20, 0x20, 0x20, 0x20, 0x3F, 0x10, 0x08, 0x07, 0x00, 0x00, 0x04, 0x04, 0x07, 0x04, 0x04,
0x00, 0x00, 0x07, 0x00, 0x03, 0x04, 0x07, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00
};

const unsigned char tinyInvadersTitle [240] = {
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
0xFF, 0xFF, 0xFF, 0xFF, 0xF8, 0xF0, 0x04, 0x04, 0xFC, 0xFC, 0x04, 0xF4, 0xF1, 0xFF, 0x18, 0x10,
0x94, 0x84, 0xFC, 0xFC, 0x84, 0x94, 0x31, 0xFF, 0x00, 0x00, 0xFC, 0xFC, 0x04, 0x04, 0xFC, 0xFC,
0x01, 0xFF, 0xE0, 0xC0, 0x1C, 0x1C, 0xF0, 0xF0, 0x1C, 0xDC, 0xC1, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF,
0x63, 0x43, 0x53, 0x13, 0xF3, 0xF3, 0x13, 0x53, 0xC7, 0xFF, 0x03, 0x03, 0xF3, 0xF3, 0x13, 0x13,
0xF3, 0xF3, 0x07, 0xFF, 0x03, 0x03, 0xF3, 0xF2, 0x02, 0x02, 0xF2, 0xF3, 0x07, 0xFF, 0x03, 0x02,
0xF2, 0xF2, 0x92, 0x92, 0xF2, 0xF2, 0x06, 0xFF, 0x03, 0x02, 0xF2, 0xF2, 0x12, 0x12, 0xF2, 0xE6,
0x0E, 0xFF, 0x03, 0x03, 0xF3, 0xF2, 0x52, 0x52, 0x52, 0x53, 0x07, 0xFF, 0x03, 0x03, 0xF3, 0xF3,
0x93, 0x93, 0xF3, 0x73, 0x07, 0xFF, 0x03, 0x03, 0xF3, 0xF3, 0xD3, 0xD3, 0xD3, 0xD3, 0x07, 0xFF,
0xFC, 0xF8, 0xFA, 0xFA, 0xFB, 0xFB, 0xFA, 0xFA, 0xF8, 0xFF, 0xFC, 0xF8, 0xFB, 0xFB, 0xF8, 0xF8,
0xFB, 0xFB, 0xF8, 0xFF, 0xFF, 0xFE, 0xFC, 0xF9, 0xFB, 0xFB, 0xF9, 0xFC, 0xFE, 0xFF, 0xFC, 0xF8,
0xFB, 0xFB, 0xF8, 0xF8, 0xFB, 0xFB, 0xF8, 0xFF, 0xFC, 0xF8, 0xFB, 0xFB, 0xFA, 0xFA, 0xFB, 0xF9,
0xFC, 0xFF, 0xFC, 0xF8, 0xFB, 0xFB, 0xFA, 0xFA, 0xFA, 0xFA, 0xF8, 0xFF, 0xFC, 0xF8, 0xFB, 0xFB,
0xF8, 0xF8, 0xFB, 0xFB, 0xF8, 0xFF, 0xFC, 0xF8, 0xFA, 0xFA, 0xFA, 0xFA, 0xFB, 0xFB, 0xF8, 0xFF
};

void setup() {
  ssd1306_128x64_i2c_initEx(PIN_SCL,PIN_SDA, 0);
  ssd1306_setFixedFont(ssd1306xled_font6x8);
  ssd1306_clearScreen();
  saveBitmapIntoEEPROM(gameTinyLogo, 160, 40, 32, LOGO_EEPROM_ADDR);
  delay(1000);
  //saveBitmapIntoEEPROM(tinyInvadersTitle, 240,80, 24, 0);
  delay(1000);
  // Reset score
  eeprom_write_word(HIGH_SCORE_EEPROM_ADDR, 0);
}

void saveBitmapIntoEEPROM(const unsigned char* bmp, int bmpSize, int width, int height, int addr) {
  while(!eeprom_is_ready()) {}
  
  ssd1306_printFixed (0, 0, "Start writing to eeprom", STYLE_NORMAL);
  delay(1000);
  ssd1306_clearScreen();
  ssd1306_drawBuffer(0, 0, width, height, bmp);

  delay(1000);
  ssd1306_clearScreen();
  eeprom_write_block(bmp, addr, bmpSize);
  ssd1306_printFixed (0, 0, "Finished writing to eeprom", STYLE_NORMAL);
  delay(1000); 
  ssd1306_clearScreen();

  unsigned char bitmapFromROM [bmpSize];
  ssd1306_printFixed (0, 0, "Reading back", STYLE_NORMAL);
  delay(1000); 
  while(!eeprom_is_ready()) {}
  ssd1306_clearScreen();
  eeprom_read_block(bitmapFromROM, addr, bmpSize);
  ssd1306_drawBuffer(0, 0, width, height, bitmapFromROM);
  delay(1000); 
}


void loop() {

}
